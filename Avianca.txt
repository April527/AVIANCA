--2. Punto
--crear tablespaces

--a. Primero con 2 GB y 1 datafile
CREATE TABLESPACE avianca 
  DATAFILE 'Aviancatbs_01.dat' SIZE 2G
  ONLINE;

--b. segundo undo con 25MB y 1 datafile
CREATE UNDO TABLESPACE undotbs01
  DATAFILE 'undotbs_01.f'
  SIZE 25M AUTOEXTEND ON
  RETENTION GUARANTEE;
  
--3. Punto
--se establece undotbs01 en el sistema
ALTER SYSTEM SET UNDO_TABLESPACE = undotbs01;

--4. Punto
--crear usuario DBA
--ALTER SESSION SET "_ORACLE_SCRIPT" = TRUE;
CREATE USER Admin
  IDENTIFIED BY dba123
  DEFAULT TABLESPACE avianca
  QUOTA UNLIMITED ON avianca;

--rol y permiso para DBA
--SELECT * FROM DBA_ROLES;
GRANT DBA TO Admin;
GRANT CONNECT TO Admin;

--5. Punto
--crear 2 perfiles
--a.Perfil 1: manager
CREATE PROFILE perfil_clerk LIMIT 
  SESSIONS_PER_USER          1
  PASSWORD_LIFE_TIME         40
  IDLE_TIME                  10
  FAILED_LOGIN_ATTEMPTS      4;

--c.Perfil 3: development
CREATE PROFILE perfil_development LIMIT 
  SESSIONS_PER_USER          2
  PASSWORD_LIFE_TIME         100
  IDLE_TIME                  30;

--6. Punto
--crear 4 usuarios
CREATE USER User1
IDENTIFIED BY User1123
DEFAULT TABLESPACE avianca
PROFILE perfil_clerk;
GRANT CONNECT TO User1;


CREATE USER User2
IDENTIFIED BY User2123
DEFAULT TABLESPACE avianca
PROFILE perfil_clerk;
GRANT CONNECT TO User2;


CREATE USER User3
IDENTIFIED BY User3123
DEFAULT TABLESPACE avianca
PROFILE perfil_development;
GRANT CONNECT TO User3;


CREATE USER User4
IDENTIFIED BY User4123
DEFAULT TABLESPACE avianca
PROFILE perfil_development;
GRANT CONNECT TO User4;

--7. Punto
--bloquear 1 usuario con el perfil clerk
ALTER USER User1 ACCOUNT LOCK;






--8. Punto
-----------------
---Crea tablas---
-----------------

--Crea tabla pais
CREATE TABLE PAISES(
  ID NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY NOT NULL,
  CIUDAD VARCHAR2 (255) NOT NULL,
  PAIS VARCHAR2 (255) NOT NULL
);

--Crea tabla empleados
CREATE TABLE EMPLEADOS(
  ID NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY NOT NULL,
  TIPO_PERSONAL VARCHAR(255) NOT NULL CHECK (TIPO_PERSONAL IN ('Pilotos','Auxiliares de Servicio')),
  NOMBRES VARCHAR2 (255) NOT NULL,
  APELLIDOS VARCHAR2 (255) NOT NULL,
  SEXO VARCHAR2 (255) NOT NULL CHECK (SEXO IN ('Femenino','Masculino')),
  FECHA_NACIMIENTO DATE,
  ANTIGUEDAD NUMBER,
  FECHA_ULTIMO_ENTRENAMIENTO DATE,
  DIRECCION_RESIDENCIA VARCHAR2 (255) NOT NULL,
  CORREO_ELECTRONICO VARCHAR2 (255),
  CELULAR_CONTACTO VARCHAR2 (255) NOT NULL,
  HORAS_DESCANSO_ULTIMO_VUELO NUMBER,
  ESTADO VARCHAR2 (255) NOT NULL CHECK (ESTADO IN ('EN VUELO','ACTIVO','INACTIVO','JUBILADO'
                                        ,'SUSPENDIDO','DESPEDIDO','ENTRENAMIENTO','LICENCIA','VACACIONES')),
  PAISES_ID NUMBER NOT NULL,--UBICACION ACTUAL
  
  CONSTRAINT FK_PAISES_EMPLEADOS FOREIGN KEY (PAISES_ID) REFERENCES PAISES(ID)
);

--Crea tabla pilotos
CREATE TABLE PILOTOS(
  ID NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY NOT NULL,
  NIVEL_INGLES VARCHAR2 (255) NOT NULL CHECK (NIVEL_INGLES IN ('Nivel 1 Pre-elementary','Nivel 2 Elementary','Nivel 3 Pre-Operational'
                                              ,'Nivel 4 Operational','Nivel 5 Extended','Nivel 6 Expert')),
  NUM_HORAS_VUELO NUMBER,
  TIPO_LICENCIA VARCHAR2 (255) NOT NULL CHECK (TIPO_LICENCIA IN ('CPL','CPL-IFR','CPL-ME','CPL-IFR-ME','ATPL')),
  CARGO VARCHAR2 (255) NOT NULL CHECK (CARGO IN ('comandante','primer oficial')),
  EMPLEADOS_ID NUMBER NOT NULL,
  
  CONSTRAINT FK_PILOTOS_EMPLEADOS FOREIGN KEY (EMPLEADOS_ID) REFERENCES EMPLEADOS(ID)
);

--Crea tabla aeropuertos
CREATE TABLE AEROPUERTOS(
  ID NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY NOT NULL,
  ABREVIATURA VARCHAR2(255),
  NOMBRE VARCHAR2 (255) NOT NULL,
  COORDENADAS VARCHAR2 (255),
  PAISES_ID NUMBER NOT NULL,--UBICACION AEROPUERTO
 
  CONSTRAINT FK_PAISES_AEROPUERTOS FOREIGN KEY (PAISES_ID) REFERENCES PAISES(ID)
);

--Crea tabla aviones
CREATE TABLE AVIONES(
  ID NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY NOT NULL,
  MATRICULA VARCHAR2 (255) NOT NULL,
  TIPO_AVION VARCHAR2 (255) NOT NULL CHECK (TIPO_AVION IN ('Airbus A320-251N','Airbus A321-253N','Airbus A318-111','Airbus A319-112','Airbus A320-214'
                                            ,'Airbus A321-231','Airbus A330-243','Airbus A330-343','ATR 72-600','Boeing 787-8 Dreamliner','Embraer ERJ-190AR')),
  NUM_SERIAL VARCHAR2 (255) NOT NULL,
  EDAD VARCHAR2 (255) NOT NULL,
  NUM_ASIENTOS_PRIMERA_CLASE NUMBER,
  NUM_ASIENTOS_ECONOMICO NUMBER,
  NUM_ASIENTOS_ESTANDAR NUMBER
);

--Crea tabla rutas
CREATE TABLE RUTAS(
  ID NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY NOT NULL,
  DISTANCIA_KM NUMBER,
  CANTIDAD_PROMEDIO_HORAS NUMBER,
  AEROPUERTO_ORIGEN_ID NUMBER,
  AEROPUERTO_DESTINO_ID NUMBER,
  AVIONES_REQUERIDOS_ID NUMBER, 

  CONSTRAINT FK_AEROPUERTO_ORI_RUTAS FOREIGN KEY (AEROPUERTO_ORIGEN_ID) REFERENCES AEROPUERTOS(ID),
  CONSTRAINT FK_AEROPUERTO_DES_RUTAS FOREIGN KEY (AEROPUERTO_DESTINO_ID) REFERENCES AEROPUERTOS(ID),
  CONSTRAINT FK_AVIONES_RUTAS FOREIGN KEY (AVIONES_REQUERIDOS_ID) REFERENCES AVIONES(ID)
);

--Crea tabla vuelos
CREATE TABLE VUELOS(
  ID NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY NOT NULL,
  NUM_VUELO VARCHAR2 (255) NOT NULL,
  FECHA_SALIDA_ESTIMADA DATE,
  FECHA_LLEGADA_ESTIMADA DATE,
  HORA_SALIDA_ESTIMADA VARCHAR2 (255),
  HORA_LLEGADA_ESTIMADA VARCHAR2 (255),
  FRECUENCIA_SEMANAL NUMBER NOT NULL CHECK (FRECUENCIA_SEMANAL IN (2,8)),
  RUTA_ID NUMBER,
  AEROPUERTO_ID NUMBER,
  
  CONSTRAINT FK_AEROPUERTO_VUELOS FOREIGN KEY (AEROPUERTO_ID) REFERENCES AEROPUERTOS(ID),
  CONSTRAINT FK_RUTA_VUELOS FOREIGN KEY (RUTA_ID) REFERENCES RUTAS(ID)
);

--Crea tabla logs
CREATE TABLE LOGS(
  ID NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY NOT NULL,
  HORA_FECHA VARCHAR(255),
  HORA_UTC VARCHAR(255),
  SENAL_LLAMADA VARCHAR(255),
  POSICION VARCHAR(255),
  ALTITUD NUMBER,
  VELOCIDAD NUMBER,
  DIRECCION NUMBER,
  VUELOS_ID NUMBER,
  
  CONSTRAINT FK_VUELOS_LOGS FOREIGN KEY (VUELOS_ID) REFERENCES VUELOS(ID)
);

--Crea tabla cronogramas
CREATE TABLE CRONOGRAMAS(
  ID NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY NOT NULL,
  FECHA_REAL_SALIDA DATE,
  FECHA_REAL_LLEGADA DATE,
  HORA_REAL_SALIDA VARCHAR2 (255),
  HORA_REAL_LLEGADA VARCHAR2 (255),
  CANTIDAD_PASAJEROS_PRIMERA NUMBER,
  CANTIDAD_PASAJEROS_ECONOMICO NUMBER,
  CANTIDAD_PASAJEROS_ESTANDAR NUMBER,
  DURACION_REAL NUMBER,
  VUELO_ID NUMBER,
  EMPLEADO_ID NUMBER,
  PILOTO_ID NUMBER,
  AVION_ID NUMBER,

  CONSTRAINT FK_VUELOS_CRONOGRAMAS FOREIGN KEY (VUELO_ID) REFERENCES VUELOS(ID),
  CONSTRAINT FK_EMPLEADOS_CRONOGRAMAS FOREIGN KEY (EMPLEADO_ID) REFERENCES EMPLEADOS(ID),
  CONSTRAINT FK_PILOTOS_CRONOGRAMAS FOREIGN KEY (PILOTO_ID) REFERENCES PILOTOS(ID),
  CONSTRAINT FK_AVIONES_CRONOGRAMAS FOREIGN KEY (AVION_ID) REFERENCES AVIONES(ID)
);

--Crea tabla viajeros
CREATE TABLE VIAJEROS(
  ID NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY NOT NULL,
  TIPO_IDENTIFICACION VARCHAR2 (255) NOT NULL CHECK (TIPO_IDENTIFICACION IN ('Cédula','Pasaporte','DNI','Cédula Extranjería')),
  NUM_IDENTIFICACION VARCHAR2 (255) NOT NULL,
  NOMBRES VARCHAR2 (255),
  APELLIDOS VARCHAR2 (255)
);

--Crea tabla check in
CREATE TABLE CHECK_INS(
  ID NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY NOT NULL,
  ESTADO VARCHAR2(255),
  NUM_CHECK_IN NUMBER,
  EMAIL_CONTACTO_EMERGENCIA VARCHAR2(255),
  TELEFONO_CONTACTO_EMERGENCIA VARCHAR2(255),
  CEL_CONTACTO_EMERGENCIA VARCHAR2(255),
  PAIS_EMERGENCIA_ID NUMBER,
  VUELO_ID NUMBER,
  VIAJERO_ID NUMBER,
  CRONOGRAMA_ID NUMBER,
  
  CONSTRAINT FK_PAISES_CHECK_INS FOREIGN KEY (PAIS_EMERGENCIA_ID) REFERENCES PAISES(ID),
  CONSTRAINT FK_VUELOS_CHECK_INS FOREIGN KEY (VUELO_ID) REFERENCES VUELOS(ID),
  CONSTRAINT FK_VIAJEROS_CHECK_INS FOREIGN KEY (VIAJERO_ID) REFERENCES VIAJEROS(ID),
  CONSTRAINT FK_CRONOGRAMAS_CHECK_INS FOREIGN KEY (CRONOGRAMA_ID) REFERENCES CRONOGRAMAS(ID)
);



----------INSERT AEROPUERTOS

--------------------------------------------------------
-- Archivo creado  - sábado-abril-14-2018   
--------------------------------------------------------
--------------------------------------------------------
--  DDL for Table AEROPUERTOS
--------------------------------------------------------

  CREATE TABLE "SYSTEM"."AEROPUERTOS" 
   (	"ID" NUMBER GENERATED ALWAYS AS IDENTITY MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE , 
	"ABREVIATURA" VARCHAR2(255 BYTE), 
	"NOMBRE" VARCHAR2(255 BYTE), 
	"COORDENADAS" VARCHAR2(255 BYTE), 
	"PAISES_ID" NUMBER
   ) PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "SYSTEM" ;
REM INSERTING into SYSTEM.AEROPUERTOS
SET DEFINE OFF;
Insert into SYSTEM.AEROPUERTOS (ID,ABREVIATURA,NOMBRE,COORDENADAS,PAISES_ID) values ('1','LEMD','MADRID BARALAS AIRPORT','21.11163, 141.49807','230');
Insert into SYSTEM.AEROPUERTOS (ID,ABREVIATURA,NOMBRE,COORDENADAS,PAISES_ID) values ('2','SKCL','ALFONSO BONILLA ARAGON INTERNATIONAL AIRPORT','-71.78529, 80.39074','3');
Insert into SYSTEM.AEROPUERTOS (ID,ABREVIATURA,NOMBRE,COORDENADAS,PAISES_ID) values ('3','SKCG','RAFAEL NUNEZ INTERNATIONAL','-70.19588, 81.69233','5');
Insert into SYSTEM.AEROPUERTOS (ID,ABREVIATURA,NOMBRE,COORDENADAS,PAISES_ID) values ('4','SPJC','JORGE CHAVEZ INTERNATIONAL AIRPORT','20.15834, -127.06372','177');
Insert into SYSTEM.AEROPUERTOS (ID,ABREVIATURA,NOMBRE,COORDENADAS,PAISES_ID) values ('5','KJFK','JOHN F. KENNEDY INTERNATIONAL AIRPORT','-73.57536, -114.76584','375');
Insert into SYSTEM.AEROPUERTOS (ID,ABREVIATURA,NOMBRE,COORDENADAS,PAISES_ID) values ('6','SKBO','EL DORADO INTERNATIONAL AIRPORT','7.67136, 40.19944','1');
Insert into SYSTEM.AEROPUERTOS (ID,ABREVIATURA,NOMBRE,COORDENADAS,PAISES_ID) values ('7','MSLP','SAN SALVADOR INTERNATIONAL AIRPORT','-75.59929, 109.81986','158');
Insert into SYSTEM.AEROPUERTOS (ID,ABREVIATURA,NOMBRE,COORDENADAS,PAISES_ID) values ('8','KMIA','MIAMI INTERNATIONAL AIRPORT','-43.24138, -143.8701','414');
--------------------------------------------------------
--  DDL for Index SYS_C0010235
--------------------------------------------------------

  CREATE UNIQUE INDEX "SYSTEM"."SYS_C0010235" ON "SYSTEM"."AEROPUERTOS" ("ID") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "SYSTEM" ;
--------------------------------------------------------
--  Constraints for Table AEROPUERTOS
--------------------------------------------------------

  ALTER TABLE "SYSTEM"."AEROPUERTOS" ADD PRIMARY KEY ("ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "SYSTEM"  ENABLE;
  ALTER TABLE "SYSTEM"."AEROPUERTOS" MODIFY ("PAISES_ID" NOT NULL ENABLE);
  ALTER TABLE "SYSTEM"."AEROPUERTOS" MODIFY ("NOMBRE" NOT NULL ENABLE);
  ALTER TABLE "SYSTEM"."AEROPUERTOS" MODIFY ("ID" NOT NULL ENABLE);
